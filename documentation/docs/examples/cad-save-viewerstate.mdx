---
id: cad-save-viewerstate
title: Saving viewer state
description: Demo shows how to save viewerstate of 3d models from CDF with Cognite3DViewer.
---
import { DemoWrapper } from '@site/docs/components/DemoWrapper';

Reveal supports saving the camera state and styled filters that have been applied to the loaded model(s).
This functionality can help support sharing links and local storage of a given view.
Internally the input to a given filter is stored and is replayed when restoring the view.
This usually means that substantially less data needs to be serialized in order to share the given state of the viewer.
The serialized JSON blob also keeps information about styling/filtering of the model by storing all [styled sets](./cad-styling.mdx). 

<DemoWrapper name="Cognite3DViewerDemo" />

# Getting the viewer state
In the example below we apply some filter to our loaded model using the `NodeSet` type from [Styling Cad models](./cad-styling.mdx).
Then we can call the ```viewer.getViewState()``` function which return a serialized JSON blob containing the view state.
Depending on the application, the view state can be additionally transformed into e.g. a URL parameter and transferred through a link.

In the example below, we keep simply print it to the developer console. 

```js runnable
const allPipes = new ByNodePropertyNodeSet(sdk, model);
allPipes.executeFilter({'PDMS': {'Type': 'PIPE'}});
model.setDefaultNodeAppearance(DefaultNodeAppearance.Ghosted);
model.addStyledNodeSet(allPipes, { renderGhosted: false, color: [40, 200, 20] } );

console.log(JSON.stringify(viewer.getViewState(), null, 2));
```

## Setting the viewer state
Restoring the viewer state is simply a matter of feeding back the JSON blob retrieved from ```const myState = viewer.getViewState()``` into ```viewer.setViewState(myState)```.
In the example below, a previously stored state is applied which applies a red color to nodes that have an attribute `'PDMS.Type'`.

:::note
Setting the viewer state assumes that model has already been loaded. 
An error will be thrown if a given state is loaded for a model which does not exist.  
:::

```js runnable

const myState = {
  "camera": {
    "position": {
      "x": 165.603,
      "y": 41.649,
      "z": -10.940
    },
    "target": {
      "x": 130.537,
      "y": 49.138,
      "z": -119.095
    }
  },
  "models": [
    {
      "defaultNodeAppearance": {
        "renderGhosted": true
      },
      "modelId": 3356984403684032,
      "revisionId": 6664823881595566,
      "styledSets": [
        {
          "token": "ByNodePropertyNodeSet",
          "state": {
            "PDMS": {
              "Type": "PIPE"
            }
          },
          "options": {
            "requestPartitions": 1
          },
          "appearance": {
            "renderGhosted": false,
            "color": [
              200,
              40,
              20
            ]
          }
        }
      ]
    }
  ]
};

viewer.setViewState(myState);
```

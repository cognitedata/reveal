{"ast":null,"code":"import _ from 'lodash';\nimport sdk, { getFlow } from '@cognite/cdf-sdk-singleton';\nimport { getProject } from '@cognite/cdf-utilities';\nimport UploadGCS from '@cognite/gcs-browser-upload';\nimport { sleep } from '../helpers';\nimport { newestCall } from './sorting';\n\n// Using react-query#useQuery calls the function with a QueryKey as the first\n// argument, useMutation does not.\n\nconst getCallsSdk = ({\n  id,\n  scheduleId\n}) => {\n  if (!id) {\n    throw new Error('id missing');\n  }\n  const filter = scheduleId ? {\n    scheduleId\n  } : {};\n  return sdk.post(`/api/v1/projects/${getProject()}/functions/${id}/calls/list`, {\n    data: {\n      filter\n    }\n  }).then(response => response.data?.items);\n};\nexport const getCalls = async (_, args) => {\n  return getCallsSdk(args);\n};\nexport const getLatestCalls = async (_, args) => {\n  const requests = args.map(a => getCallsSdk(a));\n  const results = await Promise.all(requests);\n  return args.reduce((accl, {\n    id\n  }, index) => ({\n    ...accl,\n    [id]: results[index].sort(newestCall)[0]\n  }), {});\n};\nexport const getCall = (_, {\n  id,\n  callId\n}) => {\n  if (!id) {\n    throw new Error('id missing');\n  }\n  if (!callId) {\n    throw new Error('callId missing');\n  }\n  return sdk.get(`/api/v1/projects/${getProject()}/functions/${id}/calls/${callId}`).then(response => response.data);\n};\nexport const getResponse = (_, {\n  id,\n  callId\n}) => {\n  if (!id) {\n    throw new Error('id missing');\n  }\n  if (!callId) {\n    throw new Error('callId missing');\n  }\n  return sdk.get(`/api/v1/projects/${getProject()}/functions/${id}/calls/${callId}/response`).then(response => response?.data?.response);\n};\nexport const getLogs = (_, {\n  id,\n  callId\n}) => {\n  if (!id) {\n    throw new Error('id missing');\n  }\n  if (!callId) {\n    throw new Error('callId missing');\n  }\n  return sdk.get(`/api/v1/projects/${getProject()}/functions/${id}/calls/${callId}/logs`).then(response => response?.data?.items);\n};\nexport const createFunctionCall = async ({\n  id,\n  data,\n  isOIDC\n}) => {\n  if (!id) {\n    throw new Error('id missing');\n  }\n  const {\n    nonce\n  } = isOIDC && (await createSession());\n  return sdk.post(`/api/v1/projects/${getProject()}/functions/${id}/call`, {\n    data: {\n      data: data || {},\n      nonce\n    }\n  }).then(response => response?.data);\n};\nexport const createSchedule = async ({\n  schedule,\n  clientCredentials\n}) => {\n  const {\n    nonce\n  } = !!clientCredentials && (await createSession(clientCredentials));\n  return sdk.post(`/api/v1/projects/${getProject()}/functions/schedules`, {\n    data: {\n      items: [{\n        ...schedule,\n        nonce\n      }]\n    }\n  }).then(response => response?.data);\n};\n\n// Get the input data for scheduling item\nexport const getScheduleData = scheduleId => {\n  return sdk.get(`/api/v1/projects/${getProject()}/functions/schedules/${scheduleId}/input_data`).then(response => response.data?.data);\n};\nexport const deleteSchedule = id => sdk.post(`/api/v1/projects/${getProject()}/functions/schedules/delete`, {\n  data: {\n    items: [{\n      id\n    }]\n  }\n}).then(response => response?.data);\nconst createFunction = cogfunction => {\n  return sdk.post(`/api/v1/projects/${getProject()}/functions`, {\n    data: {\n      items: [cogfunction]\n    }\n  }).then(response => response?.data);\n};\nexport const deleteFunction = async ({\n  id,\n  fileId\n}) => {\n  if (!id) {\n    throw new Error('id missing');\n  }\n  const deleteResponse = await sdk.post(`/api/v1/projects/${getProject()}/functions/delete`, {\n    data: {\n      items: [{\n        id\n      }]\n    }\n  }).then(response => response?.data);\n  if (fileId) {\n    await sdk.files.delete([{\n      id: fileId\n    }]);\n  }\n  return deleteResponse;\n};\nconst GCSUploader = (file, uploadUrl, callback = _.noop) => {\n  // This is what is recommended from google when uploading files.\n  // https://github.com/QubitProducts/gcs-browser-upload\n  const chunkMultiple = Math.min(Math.max(2,\n  // 0.5MB min chunks\n  Math.ceil((file.size || 1) / 20 * 262144) // will divide into 20 segments\n  ), 200 // 50 MB max\n  );\n\n  return new UploadGCS({\n    id: 'datastudio-upload',\n    url: uploadUrl,\n    file,\n    chunkSize: 262144 * chunkMultiple,\n    onChunkUpload: callback\n  });\n};\n_c = GCSUploader;\nconst uploadFile = async (file, dataSetId) => {\n  const {\n    uploadUrl,\n    id\n  } = await sdk.files.upload({\n    name: file.name,\n    source: 'Datastudio',\n    dataSetId\n  });\n  if (!uploadUrl) {\n    throw new Error('Upload error, did not recieve \"uploadUrl\"');\n  }\n  if (!id) {\n    throw new Error('Upload error, did not recieve \"id\"');\n  }\n  const currentUpload = await GCSUploader(file, uploadUrl, info => {\n    file.response = info;\n    file.percent = info.uploadedBytes / info.totalBytes * 100;\n  });\n  await currentUpload.start();\n  let fileInfo = await sdk.files.retrieve([{\n    id\n  }]).then(r => r[0]);\n  let retries = 0;\n  while (!fileInfo.uploaded && retries <= 10) {\n    retries += 1;\n    /* eslint-disable no-await-in-loop */\n    await sleep(retries * 1000);\n    fileInfo = await sdk.files.retrieve([{\n      id\n    }]).then(r => r[0]);\n  }\n  if (!fileInfo.uploaded) {\n    return Promise.reject(fileInfo.id);\n  }\n  return id;\n};\nexport const uploadFunction = async ({\n  data,\n  file,\n  dataSetId\n}) => {\n  const fileId = await uploadFile(file, dataSetId);\n  try {\n    const {\n      id\n    } = await createFunction({\n      ...data,\n      fileId\n    });\n    return id;\n  } catch (e) {\n    await sdk.files.delete([{\n      id: fileId\n    }]);\n    throw e;\n  }\n};\nexport const createSession = clientCredentials => {\n  return sdk.post(`/api/v1/projects/${getProject()}/sessions`, {\n    data: {\n      items: [clientCredentials || {\n        tokenExchange: true\n      }]\n    }\n  }).then(response => response?.data.items[0]);\n};\nexport const isOIDCFlow = () => {\n  const {\n    flow\n  } = getFlow();\n  return flow !== 'COGNITE_AUTH';\n};\nvar _c;\n$RefreshReg$(_c, \"GCSUploader\");","map":{"version":3,"names":["_","sdk","getFlow","getProject","UploadGCS","sleep","newestCall","getCallsSdk","id","scheduleId","Error","filter","post","data","then","response","items","getCalls","args","getLatestCalls","requests","map","a","results","Promise","all","reduce","accl","index","sort","getCall","callId","get","getResponse","getLogs","createFunctionCall","isOIDC","nonce","createSession","createSchedule","schedule","clientCredentials","getScheduleData","deleteSchedule","createFunction","cogfunction","deleteFunction","fileId","deleteResponse","files","delete","GCSUploader","file","uploadUrl","callback","noop","chunkMultiple","Math","min","max","ceil","size","url","chunkSize","onChunkUpload","uploadFile","dataSetId","upload","name","source","currentUpload","info","percent","uploadedBytes","totalBytes","start","fileInfo","retrieve","r","retries","uploaded","reject","uploadFunction","e","tokenExchange","isOIDCFlow","flow"],"sources":["/Volumes/csvol/fusion/apps/functions-ui/src/utils/api.ts"],"sourcesContent":["import { QueryKey } from '@tanstack/react-query';\nimport { UploadFile } from 'antd/lib/upload/interface';\nimport _ from 'lodash';\n\nimport sdk, { getFlow } from '@cognite/cdf-sdk-singleton';\nimport { getProject } from '@cognite/cdf-utilities';\nimport UploadGCS from '@cognite/gcs-browser-upload';\nimport { FileUploadResponse } from '@cognite/sdk';\n\nimport { sleep } from '../helpers';\nimport {\n  CogFunctionUpload,\n  CogFunction,\n  GetCallArgs,\n  CallResponse,\n  GetCallsArgs,\n  Call,\n  CreateScheduleApiParams,\n} from '../types';\n\nimport { newestCall } from './sorting';\n\n// Using react-query#useQuery calls the function with a QueryKey as the first\n// argument, useMutation does not.\n\nconst getCallsSdk = ({ id, scheduleId }: GetCallsArgs): Promise<Call[]> => {\n  if (!id) {\n    throw new Error('id missing');\n  }\n  const filter = scheduleId ? { scheduleId } : {};\n  return sdk\n    .post(`/api/v1/projects/${getProject()}/functions/${id}/calls/list`, {\n      data: { filter },\n    })\n    .then((response) => response.data?.items);\n};\n\nexport const getCalls = async (_: QueryKey, args: GetCallsArgs) => {\n  return getCallsSdk(args);\n};\n\nexport const getLatestCalls = async (_: QueryKey, args: GetCallsArgs[]) => {\n  const requests = args.map((a) => getCallsSdk(a));\n  const results = await Promise.all(requests);\n  return args.reduce(\n    (accl, { id }, index) => ({\n      ...accl,\n      [id]: results[index].sort(newestCall)[0],\n    }),\n    {}\n  );\n};\n\nexport const getCall = (_: QueryKey, { id, callId }: GetCallArgs) => {\n  if (!id) {\n    throw new Error('id missing');\n  }\n  if (!callId) {\n    throw new Error('callId missing');\n  }\n  return sdk\n    .get(`/api/v1/projects/${getProject()}/functions/${id}/calls/${callId}`)\n    .then((response) => response.data);\n};\n\ntype GetResponseArgs = {\n  id: number;\n  callId: number;\n};\nexport const getResponse = (_: QueryKey, { id, callId }: GetResponseArgs) => {\n  if (!id) {\n    throw new Error('id missing');\n  }\n  if (!callId) {\n    throw new Error('callId missing');\n  }\n  return sdk\n    .get(\n      `/api/v1/projects/${getProject()}/functions/${id}/calls/${callId}/response`\n    )\n    .then((response) => response?.data?.response);\n};\n\nexport const getLogs = (_: QueryKey, { id, callId }: GetResponseArgs) => {\n  if (!id) {\n    throw new Error('id missing');\n  }\n  if (!callId) {\n    throw new Error('callId missing');\n  }\n  return sdk\n    .get(\n      `/api/v1/projects/${getProject()}/functions/${id}/calls/${callId}/logs`\n    )\n    .then((response) => response?.data?.items);\n};\n\nexport const createFunctionCall = async ({\n  id,\n  data,\n  isOIDC,\n}: {\n  id: number;\n  data: any;\n  isOIDC?: boolean;\n}): Promise<CallResponse> => {\n  if (!id) {\n    throw new Error('id missing');\n  }\n\n  const { nonce } = isOIDC && (await createSession());\n  return sdk\n    .post(`/api/v1/projects/${getProject()}/functions/${id}/call`, {\n      data: { data: data || {}, nonce },\n    })\n    .then((response) => response?.data);\n};\n\nexport const createSchedule = async ({\n  schedule,\n  clientCredentials,\n}: CreateScheduleApiParams) => {\n  const { nonce } =\n    !!clientCredentials && (await createSession(clientCredentials));\n  return sdk\n    .post(`/api/v1/projects/${getProject()}/functions/schedules`, {\n      data: { items: [{ ...schedule, nonce }] },\n    })\n    .then((response) => response?.data);\n};\n\n// Get the input data for scheduling item\nexport const getScheduleData = (scheduleId: number) => {\n  return sdk\n    .get(\n      `/api/v1/projects/${getProject()}/functions/schedules/${scheduleId}/input_data`\n    )\n    .then((response) => response.data?.data);\n};\n\nexport const deleteSchedule = (id: number) =>\n  sdk\n    .post(`/api/v1/projects/${getProject()}/functions/schedules/delete`, {\n      data: { items: [{ id }] },\n    })\n    .then((response) => response?.data);\n\nconst createFunction = (\n  cogfunction: CogFunctionUpload\n): Promise<CogFunction> => {\n  return sdk\n    .post(`/api/v1/projects/${getProject()}/functions`, {\n      data: { items: [cogfunction] },\n    })\n    .then((response) => response?.data);\n};\nexport const deleteFunction = async ({\n  id,\n  fileId,\n}: {\n  id: number;\n  fileId?: number;\n}) => {\n  if (!id) {\n    throw new Error('id missing');\n  }\n  const deleteResponse = await sdk\n    .post(`/api/v1/projects/${getProject()}/functions/delete`, {\n      data: { items: [{ id }] },\n    })\n    .then((response) => response?.data);\n  if (fileId) {\n    await sdk.files.delete([{ id: fileId }]);\n  }\n  return deleteResponse;\n};\n\nconst GCSUploader = (\n  file: Blob | UploadFile,\n  uploadUrl: string,\n  callback: (info: any) => void = _.noop\n) => {\n  // This is what is recommended from google when uploading files.\n  // https://github.com/QubitProducts/gcs-browser-upload\n  const chunkMultiple = Math.min(\n    Math.max(\n      2, // 0.5MB min chunks\n      Math.ceil(((file.size || 1) / 20) * 262144) // will divide into 20 segments\n    ),\n    200 // 50 MB max\n  );\n\n  return new UploadGCS({\n    id: 'datastudio-upload',\n    url: uploadUrl,\n    file,\n    chunkSize: 262144 * chunkMultiple,\n    onChunkUpload: callback,\n  });\n};\n\nconst uploadFile = async (file: UploadFile, dataSetId: number | undefined) => {\n  const { uploadUrl, id } = (await sdk.files.upload({\n    name: file.name,\n    source: 'Datastudio',\n    dataSetId,\n  })) as FileUploadResponse;\n  if (!uploadUrl) {\n    throw new Error('Upload error, did not recieve \"uploadUrl\"');\n  }\n  if (!id) {\n    throw new Error('Upload error, did not recieve \"id\"');\n  }\n\n  const currentUpload = await GCSUploader(file, uploadUrl, (info: any) => {\n    file.response = info;\n    file.percent = (info.uploadedBytes / info.totalBytes) * 100;\n  });\n\n  await currentUpload.start();\n\n  let fileInfo = await sdk.files.retrieve([{ id }]).then((r) => r[0]);\n  let retries = 0;\n  while (!fileInfo.uploaded && retries <= 10) {\n    retries += 1;\n    /* eslint-disable no-await-in-loop */\n    await sleep(retries * 1000);\n    fileInfo = await sdk.files.retrieve([{ id }]).then((r) => r[0]);\n  }\n\n  if (!fileInfo.uploaded) {\n    return Promise.reject(fileInfo.id);\n  }\n\n  return id;\n};\n\nexport const uploadFunction = async ({\n  data,\n  file,\n  dataSetId,\n}: {\n  data: Omit<CogFunctionUpload, 'fileId'>;\n  file: UploadFile;\n  dataSetId: number | undefined;\n}) => {\n  const fileId = await uploadFile(file, dataSetId);\n  try {\n    const { id } = await createFunction({ ...data, fileId });\n    return id;\n  } catch (e) {\n    await sdk.files.delete([{ id: fileId }]);\n    throw e;\n  }\n};\n\nexport const createSession = (clientCredentials?: {\n  clientId: string;\n  clientSecret: string;\n}) => {\n  return sdk\n    .post(`/api/v1/projects/${getProject()}/sessions`, {\n      data: {\n        items: [clientCredentials || { tokenExchange: true }],\n      },\n    })\n    .then((response) => response?.data.items[0]);\n};\n\nexport const isOIDCFlow = () => {\n  const { flow } = getFlow();\n  return flow !== 'COGNITE_AUTH';\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
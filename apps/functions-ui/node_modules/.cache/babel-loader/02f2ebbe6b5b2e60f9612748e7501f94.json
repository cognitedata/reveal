{"ast":null,"code":"import { useMemo } from 'react';\nimport omit from 'lodash/omit';\nimport { getAssetSubtreeIdFilter } from '../../../utils';\nimport { mergeDynamicFilterOptions } from '../../../utils/mergeDynamicFilterOptions';\nimport { useEventsMetadataValuesAggregateQuery } from '../../service';\nimport { mapFiltersToEventsAdvancedFilters } from '../transformers';\nexport const useEventsMetadataValuesOptionsQuery = ({\n  filter,\n  searchQuery\n}) => {\n  var _s = $RefreshSig$();\n  return _s((metadataKeys, query, options) => {\n    _s();\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const {\n      data = [],\n      isLoading\n    } = useEventsMetadataValuesAggregateQuery({\n      metadataKey: metadataKeys,\n      query,\n      options\n    });\n    const omittedFilter = omit(filter, 'metadata');\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const {\n      data: dynamicData = []\n    } = useEventsMetadataValuesAggregateQuery({\n      metadataKey: metadataKeys,\n      query,\n      options,\n      advancedFilter: mapFiltersToEventsAdvancedFilters(omittedFilter, searchQuery),\n      filter: getAssetSubtreeIdFilter(omittedFilter)\n    });\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const transformedOptions = useMemo(() => {\n      return mergeDynamicFilterOptions(data, dynamicData);\n    }, [data, dynamicData]);\n    return {\n      options: transformedOptions,\n      isLoading\n    };\n  }, \"rjQLaIARj4isZ/ImrO2CX6eSiro=\", false, function () {\n    return [useEventsMetadataValuesAggregateQuery, useEventsMetadataValuesAggregateQuery];\n  });\n};","map":{"version":3,"names":["useMemo","omit","getAssetSubtreeIdFilter","mergeDynamicFilterOptions","useEventsMetadataValuesAggregateQuery","mapFiltersToEventsAdvancedFilters","useEventsMetadataValuesOptionsQuery","filter","searchQuery","metadataKeys","query","options","data","isLoading","metadataKey","omittedFilter","dynamicData","advancedFilter","transformedOptions"],"sources":["/Volumes/csvol/fusion/libs/data-exploration/domain-layer/src/events/internal/queries/useEventsMetadataValuesOptionsQuery.ts"],"sourcesContent":["import { useMemo } from 'react';\n\nimport { UseQueryOptions } from '@tanstack/react-query';\nimport omit from 'lodash/omit';\n\nimport { InternalAssetFilters } from '@data-exploration-lib/core';\n\nimport { getAssetSubtreeIdFilter } from '../../../utils';\nimport { mergeDynamicFilterOptions } from '../../../utils/mergeDynamicFilterOptions';\nimport { useEventsMetadataValuesAggregateQuery } from '../../service';\nimport { mapFiltersToEventsAdvancedFilters } from '../transformers';\n\ninterface Props {\n  filter?: InternalAssetFilters;\n  searchQuery?: string;\n}\n\nexport const useEventsMetadataValuesOptionsQuery =\n  ({ filter, searchQuery }: Props) =>\n  (\n    metadataKeys?: string | null,\n    query?: string,\n    options?: UseQueryOptions<any>\n  ) => {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const { data = [], isLoading } = useEventsMetadataValuesAggregateQuery({\n      metadataKey: metadataKeys,\n      query,\n      options,\n    });\n\n    const omittedFilter = omit(filter, 'metadata');\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const { data: dynamicData = [] } = useEventsMetadataValuesAggregateQuery({\n      metadataKey: metadataKeys,\n      query,\n      options,\n      advancedFilter: mapFiltersToEventsAdvancedFilters(\n        omittedFilter,\n        searchQuery\n      ),\n      filter: getAssetSubtreeIdFilter(omittedFilter),\n    });\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const transformedOptions = useMemo(() => {\n      return mergeDynamicFilterOptions(data, dynamicData);\n    }, [data, dynamicData]);\n\n    return { options: transformedOptions, isLoading };\n  };\n"],"mappings":"AAAA,SAASA,OAAO,QAAQ,OAAO;AAG/B,OAAOC,IAAI,MAAM,aAAa;AAI9B,SAASC,uBAAuB,QAAQ,gBAAgB;AACxD,SAASC,yBAAyB,QAAQ,0CAA0C;AACpF,SAASC,qCAAqC,QAAQ,eAAe;AACrE,SAASC,iCAAiC,QAAQ,iBAAiB;AAOnE,OAAO,MAAMC,mCAAmC,GAC9C,CAAC;EAAEC,MAAM;EAAEC;AAAmB,CAAC;EAAA;EAAA,UAC/B,CACEC,YAA4B,EAC5BC,KAAc,EACdC,OAA8B,KAC3B;IAAA;IACH;IACA,MAAM;MAAEC,IAAI,GAAG,EAAE;MAAEC;IAAU,CAAC,GAAGT,qCAAqC,CAAC;MACrEU,WAAW,EAAEL,YAAY;MACzBC,KAAK;MACLC;IACF,CAAC,CAAC;IAEF,MAAMI,aAAa,GAAGd,IAAI,CAACM,MAAM,EAAE,UAAU,CAAC;;IAE9C;IACA,MAAM;MAAEK,IAAI,EAAEI,WAAW,GAAG;IAAG,CAAC,GAAGZ,qCAAqC,CAAC;MACvEU,WAAW,EAAEL,YAAY;MACzBC,KAAK;MACLC,OAAO;MACPM,cAAc,EAAEZ,iCAAiC,CAC/CU,aAAa,EACbP,WAAW,CACZ;MACDD,MAAM,EAAEL,uBAAuB,CAACa,aAAa;IAC/C,CAAC,CAAC;;IAEF;IACA,MAAMG,kBAAkB,GAAGlB,OAAO,CAAC,MAAM;MACvC,OAAOG,yBAAyB,CAACS,IAAI,EAAEI,WAAW,CAAC;IACrD,CAAC,EAAE,CAACJ,IAAI,EAAEI,WAAW,CAAC,CAAC;IAEvB,OAAO;MAAEL,OAAO,EAAEO,kBAAkB;MAAEL;IAAU,CAAC;EACnD,CAAC;IAAA,QA1BkCT,qCAAqC,EASnCA,qCAAqC;EAAA;AAAA,CAiBzE"},"metadata":{},"sourceType":"module"}
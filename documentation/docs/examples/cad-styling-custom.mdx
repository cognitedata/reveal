---
id: cad-styling-custom
title: Create custom node sets
describe: Create custom node sets to filter based on custom data sources and mechanisms
---

import { DemoWrapper } from '@site/docs/components/DemoWrapper';

In many cases applications will need to filter 3D nodes by some custom data source or mechanism. This
is done by extending the `NodeSet`-class. This class generates an `IndexSet` and
provides notification when the set has changed. Implementations should
be non-blocking - slow operations should be executed async and the set should
be incrementally updated to avoid blocking the viewer.

<DemoWrapper name="Cognite3DViewerDemo" />

# Simple, static node set

```js runnable

// Note! ES6 classes are not supported in this documentation, but
// the example below corresponds to the following:
/*
class MyNodeSet extends NodeSet {
  isLoading = false;

  constructor(model) {
    super();
    this._nodeCount = model.nodeCount;
    this._indexSet = new IndexSet();
    for (let i = 0; i < model.nodeCount; i += 100) {
      this._indexSet.add(i);
    }
  }

  getIndexSet() {
    return this._indexSet;
  }

  clear() {
    this._indexSet.clear();
    this.notifyChanged();
  }
};

const mySet = new MyNodeSet(model);
model.setDefaultNodeAppearance(DefaultNodeAppearance.Ghosted);
model.addStyledNodeSet(mySet, { renderGhosted: false, color: [40, 200, 20] } );
*/

const mySet = new NodeSet();
mySet.getIndexSet = () => {
  const indexSet = new IndexSet();
  for (let i = 0; i < model.nodeCount; i += 10) {
    indexSet.add(i);
  }
  return indexSet;
};
mySet.clear = () => { throw new Error('Not supported'); }

model.setDefaultNodeAppearance(DefaultNodeAppearance.Ghosted);
model.addStyledNodeSet(mySet, { renderGhosted: false, color: [40, 200, 20] } );
```

# Details about IndexSet

`IndexSet` is a specialized implementation of [`Set<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set)
that is optimized for storing ranges of numbers. This is a common case for nodes as typically a
subtree will have the same styling applied.

Although `IndexSet` supports adding and removing individual elements using `add()` and `remove()`, the best
performance is achieved by using `addRange()` and `removeRange()` whenever possible.

Also note that changes to the underlying `IndexSet` held by a `NodeSet` isn't automatically propagated
to be visible in the rendered result. In order to trigger an update after changing the underlying `IndexSet`,
use `NodeSet.notifyChanged()` (protected function). Note that this function should not be triggered too often
as it might take some time to apply the changes.

{"ast":null,"code":"import queryString from 'query-string';\nimport { unifiedSignInAppName, unifiedSigninUrls } from '../common';\nexport const getQueryParameter = parameterKey => {\n  const parameters = queryString.parse(window.location.search) ?? {};\n  return parameters[parameterKey] ?? '';\n};\nexport const getProject = () => {\n  // if unified signin, the url is apps.cognite.com/cdf/project\n  // otherwise is fusion.cognite.com/project\n  // when splitting, for fusion index is 1, for /cdf is 2\n  const projectPathParamLocation = isUsingUnifiedSignin() ? 2 : 1;\n  return new URL(window.location.href).pathname.split('/')[projectPathParamLocation];\n};\nexport const getCluster = () => {\n  const cluster = getQueryParameter('cluster');\n  return Array.isArray(cluster) ? cluster[0] : cluster;\n};\nexport const getEnv = () => {\n  const env = getQueryParameter('env');\n  return Array.isArray(env) ? env[0] : env;\n};\nexport const getOrganization = () => {\n  if (isUsingUnifiedSignin()) {\n    const organization = getQueryParameter('organization');\n    return Array.isArray(organization) ? organization[0] : organization;\n  }\n\n  // otherwise the organization is in the subdomain\n  // https://cog-appdev.dev.fusion.cogniteapp.com/\n  return window.location.hostname.split('.')[0];\n};\nexport const getUrl = (hostname, protocol = 'https') => {\n  let url = hostname;\n  if (hostname.substr(0, protocol.length) !== protocol) {\n    url = `${protocol}://${hostname}`;\n  }\n  return url;\n};\nexport const createLink = (path, queries = {}, opts) => {\n  // No more base project name\n  const cdfAppName = isUsingUnifiedSignin() ? `/${unifiedSignInAppName}` : '';\n  const project = getProject() || '';\n  const env = getEnv();\n  const cluster = getCluster();\n  const organization = isUsingUnifiedSignin() ? getOrganization() : '';\n  const query = queryString.stringify({\n    ...queries,\n    ...(env ? {\n      env\n    } : {}),\n    ...(cluster ? {\n      cluster\n    } : {}),\n    ...(organization ? {\n      organization\n    } : {})\n  }, opts);\n  if (query.length > 0) {\n    return `${cdfAppName}/${project}${path}?${query}`;\n  }\n  if (path.length > 0 && path !== '/') {\n    return `${cdfAppName}/${project}${path}`;\n  }\n  return `${cdfAppName}/${project}`;\n};\n\n/**\n * We check what Fusion environment it is by extracting what we suppose to be env\n * directly from the URL. We can't just check if the string representing env\n * is in the hostname because some org named include \"dev\" or \"prod\" string.\n *\n * Examples:\n *\n * dev.fusion.cogniteapp.com - dev - will return true for \"dev\"\n * fusion.cognite.com - prod - will return true for \"prod\"\n * next-release.fusion.cognite.com - next-release - will return true for \"next-release\"\n * devex.dev.fusion.cogniteapp.com - dev - will return true for \"dev\"\n * devex.fusion.cognite.com - prod - will return true for \"prod\"\n * devex.next-release.fusion.cognite.com - next-release - will return true for \"next-release\"\n */\nexport const checkUrl = env => {\n  const {\n    hostname\n  } = window.location;\n  // Disabling this eslint rule because Regex actually DOES need that escape\n  // eslint-disable-next-line no-useless-escape\n  const regex = /([^\\.\\s]*?)(?=.fusion)/gi;\n  const hostnameEnvMatch = hostname.match(regex);\n  const hostnameEnv = hostnameEnvMatch?.[0];\n  if (env === 'prod') {\n    /**\n     * Production environment will return:\n     * - null - if there's no org name in URL\n     * - org name - if there is org name\n     * To detect if env is production, we just check if hostname env is null or some\n     * other string than other env names.\n     */\n    const nonProdEnvs = Object.keys(Envs).filter(e => e !== Envs.PROD);\n    return !hostnameEnv || !nonProdEnvs.includes(hostnameEnv);\n  }\n  return hostnameEnv === env;\n};\nexport let Envs;\n(function (Envs) {\n  Envs[\"PROD\"] = \"prod\";\n  Envs[\"DEV\"] = \"dev\";\n  Envs[\"LOCALHOST\"] = \"localhost\";\n  Envs[\"STAGING\"] = \"staging\";\n  Envs[\"NEXT_RELEASE\"] = \"next-release\";\n  Envs[\"PR\"] = \"pr\";\n})(Envs || (Envs = {}));\nexport const isDevelopment = () => checkUrl(Envs.DEV) || checkUrl(Envs.LOCALHOST);\nexport const isStaging = () => checkUrl(Envs.STAGING) || checkUrl(Envs.PR) || checkUrl(Envs.NEXT_RELEASE);\nexport const isProduction = () => !(isStaging() || isDevelopment());\nexport const getEnvironment = () => {\n  if (isDevelopment()) {\n    return 'development';\n  }\n  if (isStaging()) {\n    return 'staging';\n  }\n  return 'production';\n};\nexport const isValidEmail = email => {\n  // Just checking by length as it's super tricky and fragile to check by char here.\n  return /^.{1,64}@.{1,255}$/.test(email);\n};\nexport const isUsingUnifiedSignin = () => {\n  return unifiedSigninUrls.includes(window.location.host) && window.location.pathname.startsWith(`/${unifiedSignInAppName}`);\n};","map":{"version":3,"names":["queryString","unifiedSignInAppName","unifiedSigninUrls","getQueryParameter","parameterKey","parameters","parse","window","location","search","getProject","projectPathParamLocation","isUsingUnifiedSignin","URL","href","pathname","split","getCluster","cluster","Array","isArray","getEnv","env","getOrganization","organization","hostname","getUrl","protocol","url","substr","length","createLink","path","queries","opts","cdfAppName","project","query","stringify","checkUrl","regex","hostnameEnvMatch","match","hostnameEnv","nonProdEnvs","Object","keys","Envs","filter","e","PROD","includes","isDevelopment","DEV","LOCALHOST","isStaging","STAGING","PR","NEXT_RELEASE","isProduction","getEnvironment","isValidEmail","email","test","host","startsWith"],"sources":["/Volumes/csvol/fusion/libs/shared/cdf-utilities/src/utils/utils.ts"],"sourcesContent":["import queryString from 'query-string';\n\nimport { unifiedSignInAppName, unifiedSigninUrls } from '../common';\n\nexport const getQueryParameter = (parameterKey: string) => {\n  const parameters = queryString.parse(window.location.search) ?? {};\n  return parameters[parameterKey] ?? '';\n};\n\nexport const getProject = () => {\n  // if unified signin, the url is apps.cognite.com/cdf/project\n  // otherwise is fusion.cognite.com/project\n  // when splitting, for fusion index is 1, for /cdf is 2\n  const projectPathParamLocation = isUsingUnifiedSignin() ? 2 : 1;\n\n  return new URL(window.location.href).pathname.split('/')[\n    projectPathParamLocation\n  ];\n};\n\nexport const getCluster = () => {\n  const cluster = getQueryParameter('cluster');\n  return Array.isArray(cluster) ? cluster[0] : cluster;\n};\n\nexport const getEnv = () => {\n  const env = getQueryParameter('env');\n  return Array.isArray(env) ? env[0] : env;\n};\n\nexport const getOrganization = () => {\n  if (isUsingUnifiedSignin()) {\n    const organization = getQueryParameter('organization');\n    return Array.isArray(organization) ? organization[0] : organization;\n  }\n\n  // otherwise the organization is in the subdomain\n  // https://cog-appdev.dev.fusion.cogniteapp.com/\n  return window.location.hostname.split('.')[0];\n};\n\nexport const getUrl = (\n  hostname: string,\n  protocol: 'https' | 'http' = 'https'\n) => {\n  let url = hostname;\n  if (hostname.substr(0, protocol.length) !== protocol) {\n    url = `${protocol}://${hostname}`;\n  }\n\n  return url;\n};\n\nexport const createLink = (\n  path: string,\n  queries: any = {},\n  opts?: queryString.StringifyOptions\n): string => {\n  // No more base project name\n  const cdfAppName = isUsingUnifiedSignin() ? `/${unifiedSignInAppName}` : '';\n  const project = getProject() || '';\n  const env = getEnv();\n  const cluster = getCluster();\n  const organization = isUsingUnifiedSignin() ? getOrganization() : '';\n  const query = queryString.stringify(\n    {\n      ...queries,\n      ...(env ? { env } : {}),\n      ...(cluster ? { cluster } : {}),\n      ...(organization ? { organization } : {}),\n    },\n    opts\n  );\n  if (query.length > 0) {\n    return `${cdfAppName}/${project}${path}?${query}`;\n  }\n  if (path.length > 0 && path !== '/') {\n    return `${cdfAppName}/${project}${path}`;\n  }\n  return `${cdfAppName}/${project}`;\n};\n\n/**\n * We check what Fusion environment it is by extracting what we suppose to be env\n * directly from the URL. We can't just check if the string representing env\n * is in the hostname because some org named include \"dev\" or \"prod\" string.\n *\n * Examples:\n *\n * dev.fusion.cogniteapp.com - dev - will return true for \"dev\"\n * fusion.cognite.com - prod - will return true for \"prod\"\n * next-release.fusion.cognite.com - next-release - will return true for \"next-release\"\n * devex.dev.fusion.cogniteapp.com - dev - will return true for \"dev\"\n * devex.fusion.cognite.com - prod - will return true for \"prod\"\n * devex.next-release.fusion.cognite.com - next-release - will return true for \"next-release\"\n */\nexport const checkUrl = (env: Envs) => {\n  const { hostname } = window.location;\n  // Disabling this eslint rule because Regex actually DOES need that escape\n  // eslint-disable-next-line no-useless-escape\n  const regex = /([^\\.\\s]*?)(?=.fusion)/gi;\n  const hostnameEnvMatch = hostname.match(regex);\n  const hostnameEnv = hostnameEnvMatch?.[0];\n  if (env === 'prod') {\n    /**\n     * Production environment will return:\n     * - null - if there's no org name in URL\n     * - org name - if there is org name\n     * To detect if env is production, we just check if hostname env is null or some\n     * other string than other env names.\n     */\n    const nonProdEnvs = Object.keys(Envs).filter((e) => e !== Envs.PROD);\n    return !hostnameEnv || !nonProdEnvs.includes(hostnameEnv);\n  }\n  return hostnameEnv === env;\n};\n\nexport enum Envs {\n  PROD = 'prod',\n  DEV = 'dev',\n  LOCALHOST = 'localhost',\n  STAGING = 'staging',\n  NEXT_RELEASE = 'next-release',\n  PR = 'pr',\n}\n\nexport const isDevelopment = () =>\n  checkUrl(Envs.DEV) || checkUrl(Envs.LOCALHOST);\nexport const isStaging = () =>\n  checkUrl(Envs.STAGING) || checkUrl(Envs.PR) || checkUrl(Envs.NEXT_RELEASE);\nexport const isProduction = () => !(isStaging() || isDevelopment());\n\nexport const getEnvironment = () => {\n  if (isDevelopment()) {\n    return 'development';\n  }\n  if (isStaging()) {\n    return 'staging';\n  }\n  return 'production';\n};\n\nexport const isValidEmail = (email: string) => {\n  // Just checking by length as it's super tricky and fragile to check by char here.\n  return /^.{1,64}@.{1,255}$/.test(email);\n};\n\nexport const isUsingUnifiedSignin = () => {\n  return (\n    unifiedSigninUrls.includes(window.location.host) &&\n    window.location.pathname.startsWith(`/${unifiedSignInAppName}`)\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}